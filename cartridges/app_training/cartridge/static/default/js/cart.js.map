{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./cartridges/app_training/cartridge/client/default/js/cart.js","webpack:///./cartridges/app_training/cartridge/client/default/js/cart/cart.js","webpack:///./cartridges/app_training/cartridge/client/default/js/components/focus.js","webpack:///./cartridges/app_training/cartridge/client/default/js/product/base.js","webpack:///./cartridges/app_training/cartridge/client/default/js/util.js"],"names":["processInclude","require","$","document","ready","base","focusHelper","appendToUrl","url","params","newUrl","indexOf","Object","keys","map","key","encodeURIComponent","join","validateBasket","data","valid","error","message","errorHtml","append","empty","resources","emptyCartMsg","numberOfItems","numItems","attr","minicartCountOfItems","title","removeClass","addClass","updateCartTotals","totals","totalShippingCost","totalTax","grandTotal","subTotal","orderLevelDiscountTotal","value","formatted","shippingLevelDiscountTotal","items","forEach","item","renderedPromotions","UUID","priceTotal","renderedPrice","createErrorNotification","updateApproachingDiscounts","approachingDiscounts","html","length","discountMsg","updateAvailability","uuid","lineItem","messages","i","availability","inStockDate","findItem","array","match","l","call","updateProductDetails","cartModel","variationAttributes","colorAttr","attributeId","colorSelector","newColor","displayValue","text","sizeAttr","sizeSelector","newSize","imageSelector","images","small","alt","options","option","optSelector","optionId","selectedValueId","displayName","qtySelector","val","quantity","newProductId","priceSelector","price","sales","decimalPrice","list","listPriceSelector","getModalHtmlElement","remove","htmlString","parseHtml","$html","parseHTML","body","find","footer","children","fillModalElement","editProductUrl","spinner","start","ajax","method","dataType","success","parsedHtml","renderedTemplate","closeButtonText","enterDialogMessage","modal","stop","confirmDelete","actionUrl","productID","productName","$deleteConfirmBtn","$productToRemoveSpan","module","exports","on","e","preventDefault","click","toggle","urlParams","pid","type","basket","toBeDeletedUUIDs","hasBonusProduct","discountsHtml","trigger","err","responseJSON","redirectUrl","window","location","href","errorMessage","preSelectQty","parents","context","hasClass","reload","parseInt","change","methodID","submit","hide","show","$form","serialize","couponCode","code","methods","editBonusProducts","focus","siblings","focusParams","event","containerSelector","firstElementSelector","lastElementSelector","nextToLastElementSelector","setTabNextFocus","response","dialog","$productContainer","closest","product","readyToOrder","available","allAvailable","toArray","every","allReady","info_selectforstock","container","id","selectedQuantity","selectedOptionValueId","updateProductUrl","form","getPidValue","uuidToBeDeleted","selectAttribute","colorAttribute","removeBonusProduct","selectBonusProduct","enableBonusProductSelection","showMoreBonusProducts","addBonusProductsToCart","focusChooseBonusProductModal","trapChooseBonusProductModalFocus","onClosingChooseBonusProductModal","KEYCODE_TAB","isTabPressed","keyCode","firstFocusableEl","lastFocusableEl","is","linkElements","shiftKey","$el","getQuantitySelector","getQuantitySelected","processSwatchValues","msgs","values","attrValue","$attrValue","$swatchButton","parent","selected","assistiveSelectedText","removeAttr","selectable","processNonSwatchValues","$attr","$defaultOption","resetUrl","updateAttrs","attrs","attrsWithSwatches","availabilityValue","availabilityMessages","getAttributesHtml","attributes","attributeGroup","ID","attribute","label","updateOptions","optionsHtml","createCarousel","imgs","carousel","carouselId","index","appendTo","first","detach","handleVariantResponse","isChoiceOfBonusProducts","isVaraint","productType","primaryImageUrls","large","$priceSelector","replaceWith","promotionsHtml","$selectButton","updateQuantities","quantities","attributeSelect","selectedValueUrl","getAddToCartUrl","chooseBonusProducts","bonusUrl","bonusChoiceRuleBased","showProductsUrlRuleBased","showProductsUrlListBased","maxBonusItems","pliUUID","addToCartUrl","pageSize","labels","selectprods","handlePostCartAdd","messageType","newBonusDiscountLineItem","setTimeout","getChildProducts","childProducts","each","push","JSON","stringify","getOptions","$elOption","urlValue","miniCartReportingUrl","currentTarget","addToCart","pidsObj","setPids","qty","reportingURL","$choiceOfBonusProduct","maxPids","submittedQty","totalQty","optionID","valueId","selectedBonusProductHtml","$selected","count","$readyToOrderBonusProducts","queryString","pidsObject","bonusProducts","qtyOption","productId","msgSuccess","include"],"mappings":"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","file":"default\\js\\cart.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./cartridges/app_training/cartridge/client/default/js/cart.js\");\n","'use strict';\n\nvar processInclude = require('./util');\n\n$(document).ready(function () {\n    processInclude(require('./cart/cart'));\n});\n","'use strict';\n\nvar base = require('../product/base');\nvar focusHelper = require('../components/focus');\n\n/**\n * appends params to a url\n * @param {string} url - Original url\n * @param {Object} params - Parameters to append\n * @returns {string} result url with appended parameters\n */\nfunction appendToUrl(url, params) {\n    var newUrl = url;\n    newUrl += (newUrl.indexOf('?') !== -1 ? '&' : '?') + Object.keys(params).map(function (key) {\n        return key + '=' + encodeURIComponent(params[key]);\n    }).join('&');\n\n    return newUrl;\n}\n\n/**\n * Checks whether the basket is valid. if invalid displays error message and disables\n * checkout button\n * @param {Object} data - AJAX response from the server\n */\nfunction validateBasket(data) {\n    if (data.valid.error) {\n        if (data.valid.message) {\n            var errorHtml = '<div class=\"alert alert-danger alert-dismissible valid-cart-error ' +\n                'fade show\" role=\"alert\">' +\n                '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">' +\n                '<span aria-hidden=\"true\">&times;</span>' +\n                '</button>' + data.valid.message + '</div>';\n\n            $('.cart-error').append(errorHtml);\n        } else {\n            $('.cart').empty().append('<div class=\"row\"> ' +\n                '<div class=\"col-12 text-center\"> ' +\n                '<h1>' + data.resources.emptyCartMsg + '</h1> ' +\n                '</div> ' +\n                '</div>'\n            );\n            $('.number-of-items').empty().append(data.resources.numberOfItems);\n            $('.minicart-quantity').empty().append(data.numItems);\n            $('.minicart-link').attr({\n                'aria-label': data.resources.minicartCountOfItems,\n                title: data.resources.minicartCountOfItems\n            });\n            $('.minicart .popover').empty();\n            $('.minicart .popover').removeClass('show');\n        }\n\n        $('.checkout-btn').addClass('disabled');\n    } else {\n        $('.checkout-btn').removeClass('disabled');\n    }\n}\n\n/**\n * re-renders the order totals and the number of items in the cart\n * @param {Object} data - AJAX response from the server\n */\nfunction updateCartTotals(data) {\n    $('.number-of-items').empty().append(data.resources.numberOfItems);\n    $('.shipping-cost').empty().append(data.totals.totalShippingCost);\n    $('.tax-total').empty().append(data.totals.totalTax);\n    $('.grand-total').empty().append(data.totals.grandTotal);\n    $('.sub-total').empty().append(data.totals.subTotal);\n    $('.minicart-quantity').empty().append(data.numItems);\n    $('.minicart-link').attr({\n        'aria-label': data.resources.minicartCountOfItems,\n        title: data.resources.minicartCountOfItems\n    });\n    if (data.totals.orderLevelDiscountTotal.value > 0) {\n        $('.order-discount').removeClass('hide-order-discount');\n        $('.order-discount-total').empty()\n            .append('- ' + data.totals.orderLevelDiscountTotal.formatted);\n    } else {\n        $('.order-discount').addClass('hide-order-discount');\n    }\n\n    if (data.totals.shippingLevelDiscountTotal.value > 0) {\n        $('.shipping-discount').removeClass('hide-shipping-discount');\n        $('.shipping-discount-total').empty().append('- ' +\n            data.totals.shippingLevelDiscountTotal.formatted);\n    } else {\n        $('.shipping-discount').addClass('hide-shipping-discount');\n    }\n\n    data.items.forEach(function (item) {\n        if (item.renderedPromotions) {\n            $('.item-' + item.UUID).empty().append(item.renderedPromotions);\n        }\n        if (item.priceTotal && item.priceTotal.renderedPrice) {\n            $('.item-total-' + item.UUID).empty().append(item.priceTotal.renderedPrice);\n        }\n    });\n}\n\n/**\n * re-renders the order totals and the number of items in the cart\n * @param {Object} message - Error message to display\n */\nfunction createErrorNotification(message) {\n    var errorHtml = '<div class=\"alert alert-danger alert-dismissible valid-cart-error ' +\n        'fade show\" role=\"alert\">' +\n        '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">' +\n        '<span aria-hidden=\"true\">&times;</span>' +\n        '</button>' + message + '</div>';\n\n    $('.cart-error').append(errorHtml);\n}\n\n/**\n * re-renders the approaching discount messages\n * @param {Object} approachingDiscounts - updated approaching discounts for the cart\n */\nfunction updateApproachingDiscounts(approachingDiscounts) {\n    var html = '';\n    $('.approaching-discounts').empty();\n    if (approachingDiscounts.length > 0) {\n        approachingDiscounts.forEach(function (item) {\n            html += '<div class=\"single-approaching-discount text-center\">'\n                + item.discountMsg + '</div>';\n        });\n    }\n    $('.approaching-discounts').append(html);\n}\n\n/**\n * Updates the availability of a product line item\n * @param {Object} data - AJAX response from the server\n * @param {string} uuid - The uuid of the product line item to update\n */\nfunction updateAvailability(data, uuid) {\n    var lineItem;\n    var messages = '';\n\n    for (var i = 0; i < data.items.length; i++) {\n        if (data.items[i].UUID === uuid) {\n            lineItem = data.items[i];\n            break;\n        }\n    }\n\n    $('.availability-' + lineItem.UUID).empty();\n\n    if (lineItem.availability) {\n        if (lineItem.availability.messages) {\n            lineItem.availability.messages.forEach(function (message) {\n                messages += '<p class=\"line-item-attributes\">' + message + '</p>';\n            });\n        }\n\n        if (lineItem.availability.inStockDate) {\n            messages += '<p class=\"line-item-attributes line-item-instock-date\">'\n                + lineItem.availability.inStockDate\n                + '</p>';\n        }\n    }\n\n    $('.availability-' + lineItem.UUID).html(messages);\n}\n\n/**\n * Finds an element in the array that matches search parameter\n * @param {array} array - array of items to search\n * @param {function} match - function that takes an element and returns a boolean indicating if the match is made\n * @returns {Object|null} - returns an element of the array that matched the query.\n */\nfunction findItem(array, match) {\n    for (var i = 0, l = array.length; i < l; i++) {\n        if (match.call(this, array[i])) {\n            return array[i];\n        }\n    }\n    return null;\n}\n\n/**\n * Updates details of a product line item\n * @param {Object} data - AJAX response from the server\n * @param {string} uuid - The uuid of the product line item to update\n */\nfunction updateProductDetails(data, uuid) {\n    var lineItem = findItem(data.cartModel.items, function (item) {\n        return item.UUID === uuid;\n    });\n\n    if (lineItem.variationAttributes) {\n        var colorAttr = findItem(lineItem.variationAttributes, function (attr) {\n            return attr.attributeId === 'color';\n        });\n\n        if (colorAttr) {\n            var colorSelector = '.Color-' + uuid;\n            var newColor = 'Color: ' + colorAttr.displayValue;\n            $(colorSelector).text(newColor);\n        }\n\n        var sizeAttr = findItem(lineItem.variationAttributes, function (attr) {\n            return attr.attributeId === 'size';\n        });\n\n        if (sizeAttr) {\n            var sizeSelector = '.Size-' + uuid;\n            var newSize = 'Size: ' + sizeAttr.displayValue;\n            $(sizeSelector).text(newSize);\n        }\n\n        var imageSelector = '.card.product-info.uuid-' + uuid + ' .item-image > img';\n        $(imageSelector).attr('src', lineItem.images.small[0].url);\n        $(imageSelector).attr('alt', lineItem.images.small[0].alt);\n        $(imageSelector).attr('title', lineItem.images.small[0].title);\n    }\n\n    if (lineItem.options && lineItem.options.length) {\n        var option = lineItem.options[0];\n        var optSelector = '.lineItem-options-values[data-option-id=\"' + option.optionId + '\"]';\n        $(optSelector).data('value-id', option.selectedValueId);\n        $(optSelector + ' .line-item-attributes').text(option.displayName);\n    }\n\n    var qtySelector = '.quantity[data-uuid=\"' + uuid + '\"]';\n    $(qtySelector).val(lineItem.quantity);\n    $(qtySelector).data('pid', data.newProductId);\n\n    $('.remove-product[data-uuid=\"' + uuid + '\"]').data('pid', data.newProductId);\n\n    var priceSelector = '.line-item-price-' + uuid + ' .sales .value';\n    $(priceSelector).text(lineItem.price.sales.formatted);\n    $(priceSelector).attr('content', lineItem.price.sales.decimalPrice);\n\n    if (lineItem.price.list) {\n        var listPriceSelector = '.line-item-price-' + uuid + ' .list .value';\n        $(listPriceSelector).text(lineItem.price.list.formatted);\n        $(listPriceSelector).attr('content', lineItem.price.list.decimalPrice);\n    }\n}\n\n/**\n * Generates the modal window on the first call.\n *\n */\nfunction getModalHtmlElement() {\n    if ($('#editProductModal').length !== 0) {\n        $('#editProductModal').remove();\n    }\n    var htmlString = '<!-- Modal -->'\n        + '<div class=\"modal fade\" id=\"editProductModal\" tabindex=\"-1\" role=\"dialog\">'\n        + '<span class=\"enter-message sr-only\" ></span>'\n        + '<div class=\"modal-dialog quick-view-dialog\">'\n        + '<!-- Modal content-->'\n        + '<div class=\"modal-content\">'\n        + '<div class=\"modal-header\">'\n        + '    <button type=\"button\" class=\"close pull-right\" data-dismiss=\"modal\">'\n        + '        <span aria-hidden=\"true\">&times;</span>'\n        + '        <span class=\"sr-only\"> </span>'\n        + '    </button>'\n        + '</div>'\n        + '<div class=\"modal-body\"></div>'\n        + '<div class=\"modal-footer\"></div>'\n        + '</div>'\n        + '</div>'\n        + '</div>';\n    $('body').append(htmlString);\n}\n\n/**\n * Parses the html for a modal window\n * @param {string} html - representing the body and footer of the modal window\n *\n * @return {Object} - Object with properties body and footer.\n */\nfunction parseHtml(html) {\n    var $html = $('<div>').append($.parseHTML(html));\n\n    var body = $html.find('.product-quickview');\n    var footer = $html.find('.modal-footer').children();\n\n    return { body: body, footer: footer };\n}\n\n/**\n * replaces the content in the modal window for product variation to be edited.\n * @param {string} editProductUrl - url to be used to retrieve a new product model\n */\nfunction fillModalElement(editProductUrl) {\n    $('.modal-body').spinner().start();\n    $.ajax({\n        url: editProductUrl,\n        method: 'GET',\n        dataType: 'json',\n        success: function (data) {\n            var parsedHtml = parseHtml(data.renderedTemplate);\n\n            $('#editProductModal .modal-body').empty();\n            $('#editProductModal .modal-body').html(parsedHtml.body);\n            $('#editProductModal .modal-footer').html(parsedHtml.footer);\n            $('#editProductModal .modal-header .close .sr-only').text(data.closeButtonText);\n            $('#editProductModal .enter-message').text(data.enterDialogMessage);\n            $('#editProductModal').modal('show');\n            $.spinner().stop();\n        },\n        error: function () {\n            $.spinner().stop();\n        }\n    });\n}\n\n/**\n * replace content of modal\n * @param {string} actionUrl - url to be used to remove product\n * @param {string} productID - pid\n * @param {string} productName - product name\n * @param {string} uuid - uuid\n */\nfunction confirmDelete(actionUrl, productID, productName, uuid) {\n    var $deleteConfirmBtn = $('.cart-delete-confirmation-btn');\n    var $productToRemoveSpan = $('.product-to-remove');\n\n    $deleteConfirmBtn.data('pid', productID);\n    $deleteConfirmBtn.data('action', actionUrl);\n    $deleteConfirmBtn.data('uuid', uuid);\n\n    $productToRemoveSpan.empty().append(productName);\n}\n\nmodule.exports = function () {\n    $('body').on('click', '.remove-product', function (e) {\n        e.preventDefault();\n\n        var actionUrl = $(this).data('action');\n        var productID = $(this).data('pid');\n        var productName = $(this).data('name');\n        var uuid = $(this).data('uuid');\n        confirmDelete(actionUrl, productID, productName, uuid);\n    });\n\n    $('body').on('afterRemoveFromCart', function (e, data) {\n        e.preventDefault();\n        confirmDelete(data.actionUrl, data.productID, data.productName, data.uuid);\n    });\n\n    $('.optional-promo').click(function (e) {\n        e.preventDefault();\n        $('.promo-code-form').toggle();\n    });\n\n    $('body').on('click', '.cart-delete-confirmation-btn', function (e) {\n        e.preventDefault();\n\n        var productID = $(this).data('pid');\n        var url = $(this).data('action');\n        var uuid = $(this).data('uuid');\n        var urlParams = {\n            pid: productID,\n            uuid: uuid\n        };\n\n        url = appendToUrl(url, urlParams);\n\n        $('body > .modal-backdrop').remove();\n\n        $.spinner().start();\n        $.ajax({\n            url: url,\n            type: 'get',\n            dataType: 'json',\n            success: function (data) {\n                if (data.basket.items.length === 0) {\n                    $('.cart').empty().append('<div class=\"row\"> ' +\n                        '<div class=\"col-12 text-center\"> ' +\n                        '<h1>' + data.basket.resources.emptyCartMsg + '</h1> ' +\n                        '</div> ' +\n                        '</div>'\n                    );\n                    $('.number-of-items').empty().append(data.basket.resources.numberOfItems);\n                    $('.minicart-quantity').empty().append(data.basket.numItems);\n                    $('.minicart-link').attr({\n                        'aria-label': data.basket.resources.minicartCountOfItems,\n                        title: data.basket.resources.minicartCountOfItems\n                    });\n                    $('.minicart .popover').empty();\n                    $('.minicart .popover').removeClass('show');\n                    $('body').removeClass('modal-open');\n                    $('html').removeClass('veiled');\n                } else {\n                    if (data.toBeDeletedUUIDs && data.toBeDeletedUUIDs.length > 0) {\n                        for (var i = 0; i < data.toBeDeletedUUIDs.length; i++) {\n                            $('.uuid-' + data.toBeDeletedUUIDs[i]).remove();\n                        }\n                    }\n                    $('.uuid-' + uuid).remove();\n                    if (!data.basket.hasBonusProduct) {\n                        $('.bonus-product').remove();\n                    }\n                    $('.coupons-and-promos').empty().append(data.basket.totals.discountsHtml);\n                    updateCartTotals(data.basket);\n                    updateApproachingDiscounts(data.basket.approachingDiscounts);\n                    $('body').trigger('setShippingMethodSelection', data.basket);\n                    validateBasket(data.basket);\n                }\n\n                $('body').trigger('cart:update');\n\n                $.spinner().stop();\n            },\n            error: function (err) {\n                if (err.responseJSON.redirectUrl) {\n                    window.location.href = err.responseJSON.redirectUrl;\n                } else {\n                    createErrorNotification(err.responseJSON.errorMessage);\n                    $.spinner().stop();\n                }\n            }\n        });\n    });\n\n    $('body').on('change', '.quantity-form > .quantity', function () {\n        var preSelectQty = $(this).data('pre-select-qty');\n        var quantity = $(this).val();\n        var productID = $(this).data('pid');\n        var url = $(this).data('action');\n        var uuid = $(this).data('uuid');\n\n        var urlParams = {\n            pid: productID,\n            quantity: quantity,\n            uuid: uuid\n        };\n        url = appendToUrl(url, urlParams);\n\n        $(this).parents('.card').spinner().start();\n\n        $.ajax({\n            url: url,\n            type: 'get',\n            context: this,\n            dataType: 'json',\n            success: function (data) {\n                $('.quantity[data-uuid=\"' + uuid + '\"]').val(quantity);\n                $('.coupons-and-promos').empty().append(data.totals.discountsHtml);\n                updateCartTotals(data);\n                updateApproachingDiscounts(data.approachingDiscounts);\n                updateAvailability(data, uuid);\n                validateBasket(data);\n                $(this).data('pre-select-qty', quantity);\n\n                $('body').trigger('cart:update');\n\n                $.spinner().stop();\n                if ($(this).parents('.product-info').hasClass('bonus-product-line-item') && $('.cart-page').length) {\n                    location.reload();\n                }\n            },\n            error: function (err) {\n                if (err.responseJSON.redirectUrl) {\n                    window.location.href = err.responseJSON.redirectUrl;\n                } else {\n                    createErrorNotification(err.responseJSON.errorMessage);\n                    $(this).val(parseInt(preSelectQty, 10));\n                    $.spinner().stop();\n                }\n            }\n        });\n    });\n\n    $('.shippingMethods').change(function () {\n        var url = $(this).attr('data-actionUrl');\n        var urlParams = {\n            methodID: $(this).find(':selected').attr('data-shipping-id')\n        };\n        // url = appendToUrl(url, urlParams);\n\n        $('.totals').spinner().start();\n        $.ajax({\n            url: url,\n            type: 'post',\n            dataType: 'json',\n            data: urlParams,\n            success: function (data) {\n                if (data.error) {\n                    window.location.href = data.redirectUrl;\n                } else {\n                    $('.coupons-and-promos').empty().append(data.totals.discountsHtml);\n                    updateCartTotals(data);\n                    updateApproachingDiscounts(data.approachingDiscounts);\n                    validateBasket(data);\n                }\n                $.spinner().stop();\n            },\n            error: function (err) {\n                if (err.redirectUrl) {\n                    window.location.href = err.redirectUrl;\n                } else {\n                    createErrorNotification(err.responseJSON.errorMessage);\n                    $.spinner().stop();\n                }\n            }\n        });\n    });\n\n    $('.promo-code-form').submit(function (e) {\n        e.preventDefault();\n        $.spinner().start();\n        $('.coupon-missing-error').hide();\n        $('.coupon-error-message').empty();\n        if (!$('.coupon-code-field').val()) {\n            $('.promo-code-form .form-control').addClass('is-invalid');\n            $('.promo-code-form .form-control').attr('aria-describedby', 'missingCouponCode');\n            $('.coupon-missing-error').show();\n            $.spinner().stop();\n            return false;\n        }\n        var $form = $('.promo-code-form');\n        $('.promo-code-form .form-control').removeClass('is-invalid');\n        $('.coupon-error-message').empty();\n\n        $.ajax({\n            url: $form.attr('action'),\n            type: 'GET',\n            dataType: 'json',\n            data: $form.serialize(),\n            success: function (data) {\n                if (data.error) {\n                    $('.promo-code-form .form-control').addClass('is-invalid');\n                    $('.promo-code-form .form-control').attr('aria-describedby', 'invalidCouponCode');\n                    $('.coupon-error-message').empty().append(data.errorMessage);\n                } else {\n                    $('.coupons-and-promos').empty().append(data.totals.discountsHtml);\n                    updateCartTotals(data);\n                    updateApproachingDiscounts(data.approachingDiscounts);\n                    validateBasket(data);\n                }\n                $('.coupon-code-field').val('');\n                $.spinner().stop();\n            },\n            error: function (err) {\n                if (err.responseJSON.redirectUrl) {\n                    window.location.href = err.responseJSON.redirectUrl;\n                } else {\n                    createErrorNotification(err.errorMessage);\n                    $.spinner().stop();\n                }\n            }\n        });\n        return false;\n    });\n\n    $('body').on('click', '.remove-coupon', function (e) {\n        e.preventDefault();\n\n        var couponCode = $(this).data('code');\n        var uuid = $(this).data('uuid');\n        var $deleteConfirmBtn = $('.delete-coupon-confirmation-btn');\n        var $productToRemoveSpan = $('.coupon-to-remove');\n\n        $deleteConfirmBtn.data('uuid', uuid);\n        $deleteConfirmBtn.data('code', couponCode);\n\n        $productToRemoveSpan.empty().append(couponCode);\n    });\n\n    $('body').on('click', '.delete-coupon-confirmation-btn', function (e) {\n        e.preventDefault();\n\n        var url = $(this).data('action');\n        var uuid = $(this).data('uuid');\n        var couponCode = $(this).data('code');\n        var urlParams = {\n            code: couponCode,\n            uuid: uuid\n        };\n\n        url = appendToUrl(url, urlParams);\n\n        $('body > .modal-backdrop').remove();\n\n        $.spinner().start();\n        $.ajax({\n            url: url,\n            type: 'get',\n            dataType: 'json',\n            success: function (data) {\n                $('.coupon-uuid-' + uuid).remove();\n                updateCartTotals(data);\n                updateApproachingDiscounts(data.approachingDiscounts);\n                validateBasket(data);\n                $.spinner().stop();\n            },\n            error: function (err) {\n                if (err.responseJSON.redirectUrl) {\n                    window.location.href = err.responseJSON.redirectUrl;\n                } else {\n                    createErrorNotification(err.responseJSON.errorMessage);\n                    $.spinner().stop();\n                }\n            }\n        });\n    });\n    $('body').on('click', '.cart-page .bonus-product-button', function () {\n        $.spinner().start();\n        $(this).addClass('launched-modal');\n        $.ajax({\n            url: $(this).data('url'),\n            method: 'GET',\n            dataType: 'json',\n            success: function (data) {\n                base.methods.editBonusProducts(data);\n                $.spinner().stop();\n            },\n            error: function () {\n                $.spinner().stop();\n            }\n        });\n    });\n\n    $('body').on('hidden.bs.modal', '#chooseBonusProductModal', function () {\n        $('#chooseBonusProductModal').remove();\n        $('.modal-backdrop').remove();\n        $('body').removeClass('modal-open');\n\n        if ($('.cart-page').length) {\n            $('.launched-modal .btn-outline-primary').trigger('focus');\n            $('.launched-modal').removeClass('launched-modal');\n        } else {\n            $('.product-detail .add-to-cart').focus();\n        }\n    });\n\n    $('body').on('click', '.cart-page .product-edit .edit, .cart-page .bundle-edit .edit', function (e) {\n        e.preventDefault();\n\n        var editProductUrl = $(this).attr('href');\n        getModalHtmlElement();\n        fillModalElement(editProductUrl);\n    });\n\n    $('body').on('shown.bs.modal', '#editProductModal', function () {\n        $('#editProductModal').siblings().attr('aria-hidden', 'true');\n        $('#editProductModal .close').focus();\n    });\n\n    $('body').on('hidden.bs.modal', '#editProductModal', function () {\n        $('#editProductModal').siblings().attr('aria-hidden', 'false');\n    });\n\n    $('body').on('keydown', '#editProductModal', function (e) {\n        var focusParams = {\n            event: e,\n            containerSelector: '#editProductModal',\n            firstElementSelector: '.close',\n            lastElementSelector: '.update-cart-product-global',\n            nextToLastElementSelector: '.modal-footer .quantity-select'\n        };\n        focusHelper.setTabNextFocus(focusParams);\n    });\n\n    $('body').on('product:updateAddToCart', function (e, response) {\n        // update global add to cart (single products, bundles)\n        var dialog = $(response.$productContainer)\n            .closest('.quick-view-dialog');\n\n        $('.update-cart-product-global', dialog).attr('disabled',\n            !$('.global-availability', dialog).data('ready-to-order')\n            || !$('.global-availability', dialog).data('available')\n        );\n    });\n\n    $('body').on('product:updateAvailability', function (e, response) {\n        // bundle individual products\n        $('.product-availability', response.$productContainer)\n            .data('ready-to-order', response.product.readyToOrder)\n            .data('available', response.product.available)\n            .find('.availability-msg')\n            .empty()\n            .html(response.message);\n\n\n        var dialog = $(response.$productContainer)\n            .closest('.quick-view-dialog');\n\n        if ($('.product-availability', dialog).length) {\n            // bundle all products\n            var allAvailable = $('.product-availability', dialog).toArray()\n                .every(function (item) { return $(item).data('available'); });\n\n            var allReady = $('.product-availability', dialog).toArray()\n                .every(function (item) { return $(item).data('ready-to-order'); });\n\n            $('.global-availability', dialog)\n                .data('ready-to-order', allReady)\n                .data('available', allAvailable);\n\n            $('.global-availability .availability-msg', dialog).empty()\n                .html(allReady ? response.message : response.resources.info_selectforstock);\n        } else {\n            // single product\n            $('.global-availability', dialog)\n                .data('ready-to-order', response.product.readyToOrder)\n                .data('available', response.product.available)\n                .find('.availability-msg')\n                .empty()\n                .html(response.message);\n        }\n    });\n\n    $('body').on('product:afterAttributeSelect', function (e, response) {\n        if ($('.modal.show .product-quickview .bundle-items').length) {\n            $('.modal.show').find(response.container).data('pid', response.data.product.id);\n            $('.modal.show').find(response.container).find('.product-id').text(response.data.product.id);\n        } else {\n            $('.modal.show .product-quickview').data('pid', response.data.product.id);\n        }\n    });\n\n    $('body').on('change', '.quantity-select', function () {\n        var selectedQuantity = $(this).val();\n        $('.modal.show .update-cart-url').data('selected-quantity', selectedQuantity);\n    });\n\n    $('body').on('change', '.options-select', function () {\n        var selectedOptionValueId = $(this).children('option:selected').data('value-id');\n        $('.modal.show .update-cart-url').data('selected-option', selectedOptionValueId);\n    });\n\n    $('body').on('click', '.update-cart-product-global', function (e) {\n        e.preventDefault();\n\n        var updateProductUrl = $(this).closest('.cart-and-ipay').find('.update-cart-url').val();\n        var selectedQuantity = $(this).closest('.cart-and-ipay').find('.update-cart-url').data('selected-quantity');\n        var selectedOptionValueId = $(this).closest('.cart-and-ipay').find('.update-cart-url').data('selected-option');\n        var uuid = $(this).closest('.cart-and-ipay').find('.update-cart-url').data('uuid');\n\n        var form = {\n            uuid: uuid,\n            pid: base.getPidValue($(this)),\n            quantity: selectedQuantity,\n            selectedOptionValueId: selectedOptionValueId\n        };\n\n        $(this).parents('.card').spinner().start();\n        if (updateProductUrl) {\n            $.ajax({\n                url: updateProductUrl,\n                type: 'post',\n                context: this,\n                data: form,\n                dataType: 'json',\n                success: function (data) {\n                    $('#editProductModal').modal('hide');\n\n                    $('.coupons-and-promos').empty().append(data.cartModel.totals.discountsHtml);\n                    updateCartTotals(data.cartModel);\n                    updateApproachingDiscounts(data.cartModel.approachingDiscounts);\n                    updateAvailability(data.cartModel, uuid);\n                    updateProductDetails(data, uuid);\n\n                    if (data.uuidToBeDeleted) {\n                        $('.uuid-' + data.uuidToBeDeleted).remove();\n                    }\n\n                    validateBasket(data.cartModel);\n\n                    $('body').trigger('cart:update');\n\n                    $.spinner().stop();\n                },\n                error: function (err) {\n                    if (err.responseJSON.redirectUrl) {\n                        window.location.href = err.responseJSON.redirectUrl;\n                    } else {\n                        createErrorNotification(err.responseJSON.errorMessage);\n                        $.spinner().stop();\n                    }\n                }\n            });\n        }\n    });\n\n    base.selectAttribute();\n    base.colorAttribute();\n    base.removeBonusProduct();\n    base.selectBonusProduct();\n    base.enableBonusProductSelection();\n    base.showMoreBonusProducts();\n    base.addBonusProductsToCart();\n    base.focusChooseBonusProductModal();\n    base.trapChooseBonusProductModalFocus();\n    base.onClosingChooseBonusProductModal();\n};\n","'use strict';\n\nmodule.exports = {\n    setTabNextFocus: function (focusParams) {\n        var KEYCODE_TAB = 9;\n        var isTabPressed = (focusParams.event.key === 'Tab' || focusParams.event.keyCode === KEYCODE_TAB);\n\n        if (!isTabPressed) {\n            return;\n        }\n\n        var firstFocusableEl = $(focusParams.containerSelector + ' ' + focusParams.firstElementSelector);\n        var lastFocusableEl = $(focusParams.containerSelector + ' ' + focusParams.lastElementSelector);\n\n        if ($(focusParams.containerSelector + ' ' + focusParams.lastElementSelector).is(':disabled')) {\n            lastFocusableEl = $(focusParams.containerSelector + ' ' + focusParams.nextToLastElementSelector);\n            if ($('.product-quickview.product-set').length > 0) {\n                var linkElements = $(focusParams.containerSelector + ' a#fa-link.share-icons');\n                lastFocusableEl = linkElements[linkElements.length - 1];\n            }\n        }\n\n        if (focusParams.event.shiftKey) /* shift + tab */ {\n            if ($(':focus').is(firstFocusableEl)) {\n                lastFocusableEl.focus();\n                focusParams.event.preventDefault();\n            }\n        } else /* tab */ {\n            if ($(':focus').is(lastFocusableEl)) { // eslint-disable-line\n                firstFocusableEl.focus();\n                focusParams.event.preventDefault();\n            }\n        }\n    }\n};\n","'use strict';\nvar focusHelper = require('../components/focus');\n\n/**\n * Retrieves the relevant pid value\n * @param {jquery} $el - DOM container for a given add to cart button\n * @return {string} - value to be used when adding product to cart\n */\nfunction getPidValue($el) {\n    var pid;\n\n    if ($('#quickViewModal').hasClass('show') && !$('.product-set').length) {\n        pid = $($el).closest('.modal-content').find('.product-quickview').data('pid');\n    } else if ($('.product-set-detail').length || $('.product-set').length) {\n        pid = $($el).closest('.product-detail').find('.product-id').text();\n    } else {\n        pid = $('.product-detail:not(\".bundle-item\")').data('pid');\n    }\n\n    return pid;\n}\n\n/**\n * Retrieve contextual quantity selector\n * @param {jquery} $el - DOM container for the relevant quantity\n * @return {jquery} - quantity selector DOM container\n */\nfunction getQuantitySelector($el) {\n    return $el && $('.set-items').length\n        ? $($el).closest('.product-detail').find('.quantity-select')\n        : $('.quantity-select');\n}\n\n/**\n * Retrieves the value associated with the Quantity pull-down menu\n * @param {jquery} $el - DOM container for the relevant quantity\n * @return {string} - value found in the quantity input\n */\nfunction getQuantitySelected($el) {\n    return getQuantitySelector($el).val();\n}\n\n/**\n * Process the attribute values for an attribute that has image swatches\n *\n * @param {Object} attr - Attribute\n * @param {string} attr.id - Attribute ID\n * @param {Object[]} attr.values - Array of attribute value objects\n * @param {string} attr.values.value - Attribute coded value\n * @param {string} attr.values.url - URL to de/select an attribute value of the product\n * @param {boolean} attr.values.isSelectable - Flag as to whether an attribute value can be\n *     selected.  If there is no variant that corresponds to a specific combination of attribute\n *     values, an attribute may be disabled in the Product Detail Page\n * @param {jQuery} $productContainer - DOM container for a given product\n * @param {Object} msgs - object containing resource messages\n */\nfunction processSwatchValues(attr, $productContainer, msgs) {\n    attr.values.forEach(function (attrValue) {\n        var $attrValue = $productContainer.find('[data-attr=\"' + attr.id + '\"] [data-attr-value=\"' +\n            attrValue.value + '\"]');\n        var $swatchButton = $attrValue.parent();\n\n        if (attrValue.selected) {\n            $attrValue.addClass('selected');\n            $attrValue.siblings('.selected-assistive-text').text(msgs.assistiveSelectedText);\n        } else {\n            $attrValue.removeClass('selected');\n            $attrValue.siblings('.selected-assistive-text').empty();\n        }\n\n        if (attrValue.url) {\n            $swatchButton.attr('data-url', attrValue.url);\n        } else {\n            $swatchButton.removeAttr('data-url');\n        }\n\n        // Disable if not selectable\n        $attrValue.removeClass('selectable unselectable');\n\n        $attrValue.addClass(attrValue.selectable ? 'selectable' : 'unselectable');\n    });\n}\n\n/**\n * Process attribute values associated with an attribute that does not have image swatches\n *\n * @param {Object} attr - Attribute\n * @param {string} attr.id - Attribute ID\n * @param {Object[]} attr.values - Array of attribute value objects\n * @param {string} attr.values.value - Attribute coded value\n * @param {string} attr.values.url - URL to de/select an attribute value of the product\n * @param {boolean} attr.values.isSelectable - Flag as to whether an attribute value can be\n *     selected.  If there is no variant that corresponds to a specific combination of attribute\n *     values, an attribute may be disabled in the Product Detail Page\n * @param {jQuery} $productContainer - DOM container for a given product\n */\nfunction processNonSwatchValues(attr, $productContainer) {\n    var $attr = '[data-attr=\"' + attr.id + '\"]';\n    var $defaultOption = $productContainer.find($attr + ' .select-' + attr.id + ' option:first');\n    $defaultOption.attr('value', attr.resetUrl);\n\n    attr.values.forEach(function (attrValue) {\n        var $attrValue = $productContainer\n            .find($attr + ' [data-attr-value=\"' + attrValue.value + '\"]');\n        $attrValue.attr('value', attrValue.url)\n            .removeAttr('disabled');\n\n        if (!attrValue.selectable) {\n            $attrValue.attr('disabled', true);\n        }\n    });\n}\n\n/**\n * Routes the handling of attribute processing depending on whether the attribute has image\n *     swatches or not\n *\n * @param {Object} attrs - Attribute\n * @param {string} attr.id - Attribute ID\n * @param {jQuery} $productContainer - DOM element for a given product\n * @param {Object} msgs - object containing resource messages\n */\nfunction updateAttrs(attrs, $productContainer, msgs) {\n    // Currently, the only attribute type that has image swatches is Color.\n    var attrsWithSwatches = ['color'];\n\n    attrs.forEach(function (attr) {\n        if (attrsWithSwatches.indexOf(attr.id) > -1) {\n            processSwatchValues(attr, $productContainer, msgs);\n        } else {\n            processNonSwatchValues(attr, $productContainer);\n        }\n    });\n}\n\n/**\n * Updates the availability status in the Product Detail Page\n *\n * @param {Object} response - Ajax response object after an\n *                            attribute value has been [de]selected\n * @param {jQuery} $productContainer - DOM element for a given product\n */\nfunction updateAvailability(response, $productContainer) {\n    var availabilityValue = '';\n    var availabilityMessages = response.product.availability.messages;\n    if (!response.product.readyToOrder) {\n        availabilityValue = '<li><div>' + response.resources.info_selectforstock + '</div></li>';\n    } else {\n        availabilityMessages.forEach(function (message) {\n            availabilityValue += '<li><div>' + message + '</div></li>';\n        });\n    }\n\n    $($productContainer).trigger('product:updateAvailability', {\n        product: response.product,\n        $productContainer: $productContainer,\n        message: availabilityValue,\n        resources: response.resources\n    });\n}\n\n/**\n * Generates html for product attributes section\n *\n * @param {array} attributes - list of attributes\n * @return {string} - Compiled HTML\n */\nfunction getAttributesHtml(attributes) {\n    if (!attributes) {\n        return '';\n    }\n\n    var html = '';\n\n    attributes.forEach(function (attributeGroup) {\n        if (attributeGroup.ID === 'mainAttributes') {\n            attributeGroup.attributes.forEach(function (attribute) {\n                html += '<div class=\"attribute-values\">' + attribute.label + ': '\n                    + attribute.value + '</div>';\n            });\n        }\n    });\n\n    return html;\n}\n\n/**\n * @typedef UpdatedOptionValue\n * @type Object\n * @property {string} id - Option value ID for look up\n * @property {string} url - Updated option value selection URL\n */\n\n/**\n * @typedef OptionSelectionResponse\n * @type Object\n * @property {string} priceHtml - Updated price HTML code\n * @property {Object} options - Updated Options\n * @property {string} options.id - Option ID\n * @property {UpdatedOptionValue[]} options.values - Option values\n */\n\n/**\n * Updates DOM using post-option selection Ajax response\n *\n * @param {OptionSelectionResponse} optionsHtml - Ajax response optionsHtml from selecting a product option\n * @param {jQuery} $productContainer - DOM element for current product\n */\nfunction updateOptions(optionsHtml, $productContainer) {\n\t// Update options\n    $productContainer.find('.product-options').empty().html(optionsHtml);\n}\n\n/**\n * Dynamically creates Bootstrap carousel from response containing images\n * @param {Object[]} imgs - Array of large product images,along with related information\n * @param {jQuery} $productContainer - DOM element for a given product\n */\nfunction createCarousel(imgs, $productContainer) {\n    var carousel = $productContainer.find('.carousel');\n    $(carousel).carousel('dispose');\n    var carouselId = $(carousel).attr('id');\n    $(carousel).empty().append('<ol class=\"carousel-indicators\"></ol><div class=\"carousel-inner\" role=\"listbox\"></div><a class=\"carousel-control-prev\" href=\"#' + carouselId + '\" role=\"button\" data-slide=\"prev\"><span class=\"fa icon-prev\" aria-hidden=\"true\"></span><span class=\"sr-only\">' + $(carousel).data('prev') + '</span></a><a class=\"carousel-control-next\" href=\"#' + carouselId + '\" role=\"button\" data-slide=\"next\"><span class=\"fa icon-next\" aria-hidden=\"true\"></span><span class=\"sr-only\">' + $(carousel).data('next') + '</span></a>');\n    for (var i = 0; i < imgs.length; i++) {\n        $('<div class=\"carousel-item\"><img src=\"' + imgs[i].url + '\" class=\"d-block img-fluid\" alt=\"' + imgs[i].alt + ' image number ' + parseInt(imgs[i].index, 10) + '\" title=\"' + imgs[i].title + '\" itemprop=\"image\" /></div>').appendTo($(carousel).find('.carousel-inner'));\n        $('<li data-target=\"#' + carouselId + '\" data-slide-to=\"' + i + '\" class=\"\"></li>').appendTo($(carousel).find('.carousel-indicators'));\n    }\n    $($(carousel).find('.carousel-item')).first().addClass('active');\n    $($(carousel).find('.carousel-indicators > li')).first().addClass('active');\n    if (imgs.length === 1) {\n        $($(carousel).find('.carousel-indicators, a[class^=\"carousel-control-\"]')).detach();\n    }\n    $(carousel).carousel();\n    $($(carousel).find('.carousel-indicators')).attr('aria-hidden', true);\n}\n\n/**\n * Parses JSON from Ajax call made whenever an attribute value is [de]selected\n * @param {Object} response - response from Ajax call\n * @param {Object} response.product - Product object\n * @param {string} response.product.id - Product ID\n * @param {Object[]} response.product.variationAttributes - Product attributes\n * @param {Object[]} response.product.images - Product images\n * @param {boolean} response.product.hasRequiredAttrsSelected - Flag as to whether all required\n *     attributes have been selected.  Used partially to\n *     determine whether the Add to Cart button can be enabled\n * @param {jQuery} $productContainer - DOM element for a given product.\n */\nfunction handleVariantResponse(response, $productContainer) {\n    var isChoiceOfBonusProducts =\n        $productContainer.parents('.choose-bonus-product-dialog').length > 0;\n    var isVaraint;\n    if (response.product.variationAttributes) {\n        updateAttrs(response.product.variationAttributes, $productContainer, response.resources);\n        isVaraint = response.product.productType === 'variant';\n        if (isChoiceOfBonusProducts && isVaraint) {\n            $productContainer.parent('.bonus-product-item')\n                .data('pid', response.product.id);\n\n            $productContainer.parent('.bonus-product-item')\n                .data('ready-to-order', response.product.readyToOrder);\n        }\n    }\n\n    // Update primary images\n    var primaryImageUrls = response.product.images.large;\n    createCarousel(primaryImageUrls, $productContainer);\n\n    // Update pricing\n    if (!isChoiceOfBonusProducts) {\n        var $priceSelector = $('.prices .price', $productContainer).length\n            ? $('.prices .price', $productContainer)\n            : $('.prices .price');\n        $priceSelector.replaceWith(response.product.price.html);\n    }\n\n    // Update promotions\n    $productContainer.find('.promotions').empty().html(response.product.promotionsHtml);\n\n    updateAvailability(response, $productContainer);\n\n    if (isChoiceOfBonusProducts) {\n        var $selectButton = $productContainer.find('.select-bonus-product');\n        $selectButton.trigger('bonusproduct:updateSelectButton', {\n            product: response.product, $productContainer: $productContainer\n        });\n    } else {\n        // Enable \"Add to Cart\" button if all required attributes have been selected\n        $('button.add-to-cart, button.add-to-cart-global, button.update-cart-product-global').trigger('product:updateAddToCart', {\n            product: response.product, $productContainer: $productContainer\n        }).trigger('product:statusUpdate', response.product);\n    }\n\n    // Update attributes\n    $productContainer.find('.main-attributes').empty()\n        .html(getAttributesHtml(response.product.attributes));\n}\n\n/**\n * @typespec UpdatedQuantity\n * @type Object\n * @property {boolean} selected - Whether the quantity has been selected\n * @property {string} value - The number of products to purchase\n * @property {string} url - Compiled URL that specifies variation attributes, product ID, options,\n *     etc.\n */\n\n/**\n * Updates the quantity DOM elements post Ajax call\n * @param {UpdatedQuantity[]} quantities -\n * @param {jQuery} $productContainer - DOM container for a given product\n */\nfunction updateQuantities(quantities, $productContainer) {\n    if (!($productContainer.parent('.bonus-product-item').length > 0)) {\n        var optionsHtml = quantities.map(function (quantity) {\n            var selected = quantity.selected ? ' selected ' : '';\n            return '<option value=\"' + quantity.value + '\"  data-url=\"' + quantity.url + '\"' +\n                selected + '>' + quantity.value + '</option>';\n        }).join('');\n        getQuantitySelector($productContainer).empty().html(optionsHtml);\n    }\n}\n\n/**\n * updates the product view when a product attribute is selected or deselected or when\n *         changing quantity\n * @param {string} selectedValueUrl - the Url for the selected variation value\n * @param {jQuery} $productContainer - DOM element for current product\n */\nfunction attributeSelect(selectedValueUrl, $productContainer) {\n    if (selectedValueUrl) {\n        $('body').trigger('product:beforeAttributeSelect',\n            { url: selectedValueUrl, container: $productContainer });\n\n        $.ajax({\n            url: selectedValueUrl,\n            method: 'GET',\n            success: function (data) {\n                handleVariantResponse(data, $productContainer);\n                updateOptions(data.product.optionsHtml, $productContainer);\n                updateQuantities(data.product.quantities, $productContainer);\n                $('body').trigger('product:afterAttributeSelect',\n                    { data: data, container: $productContainer });\n                $.spinner().stop();\n            },\n            error: function () {\n                $.spinner().stop();\n            }\n        });\n    }\n}\n\n/**\n * Retrieves url to use when adding a product to the cart\n *\n * @return {string} - The provided URL to use when adding a product to the cart\n */\nfunction getAddToCartUrl() {\n    return $('.add-to-cart-url').val();\n}\n\n/**\n * Parses the html for a modal window\n * @param {string} html - representing the body and footer of the modal window\n *\n * @return {Object} - Object with properties body and footer.\n */\nfunction parseHtml(html) {\n    var $html = $('<div>').append($.parseHTML(html));\n\n    var body = $html.find('.choice-of-bonus-product');\n    var footer = $html.find('.modal-footer').children();\n\n    return { body: body, footer: footer };\n}\n\n/**\n * Retrieves url to use when adding a product to the cart\n *\n * @param {Object} data - data object used to fill in dynamic portions of the html\n */\nfunction chooseBonusProducts(data) {\n    $('.modal-body').spinner().start();\n\n    if ($('#chooseBonusProductModal').length !== 0) {\n        $('#chooseBonusProductModal').remove();\n    }\n    var bonusUrl;\n    if (data.bonusChoiceRuleBased) {\n        bonusUrl = data.showProductsUrlRuleBased;\n    } else {\n        bonusUrl = data.showProductsUrlListBased;\n    }\n\n    var htmlString = '<!-- Modal -->'\n        + '<div class=\"modal fade\" id=\"chooseBonusProductModal\" tabindex=\"-1\" role=\"dialog\">'\n        + '<span class=\"enter-message sr-only\" ></span>'\n        + '<div class=\"modal-dialog choose-bonus-product-dialog\" '\n        + 'data-total-qty=\"' + data.maxBonusItems + '\"'\n        + 'data-UUID=\"' + data.uuid + '\"'\n        + 'data-pliUUID=\"' + data.pliUUID + '\"'\n        + 'data-addToCartUrl=\"' + data.addToCartUrl + '\"'\n        + 'data-pageStart=\"0\"'\n        + 'data-pageSize=\"' + data.pageSize + '\"'\n        + 'data-moreURL=\"' + data.showProductsUrlRuleBased + '\"'\n        + 'data-bonusChoiceRuleBased=\"' + data.bonusChoiceRuleBased + '\">'\n        + '<!-- Modal content-->'\n        + '<div class=\"modal-content\">'\n        + '<div class=\"modal-header\">'\n        + '    <span class=\"\">' + data.labels.selectprods + '</span>'\n        + '    <button type=\"button\" class=\"close pull-right\" data-dismiss=\"modal\">'\n        + '        <span aria-hidden=\"true\">&times;</span>'\n        + '        <span class=\"sr-only\"> </span>'\n        + '    </button>'\n        + '</div>'\n        + '<div class=\"modal-body\"></div>'\n        + '<div class=\"modal-footer\"></div>'\n        + '</div>'\n        + '</div>'\n        + '</div>';\n    $('body').append(htmlString);\n    $('.modal-body').spinner().start();\n\n    $.ajax({\n        url: bonusUrl,\n        method: 'GET',\n        dataType: 'json',\n        success: function (response) {\n            var parsedHtml = parseHtml(response.renderedTemplate);\n            $('#chooseBonusProductModal .modal-body').empty();\n            $('#chooseBonusProductModal .enter-message').text(response.enterDialogMessage);\n            $('#chooseBonusProductModal .modal-header .close .sr-only').text(response.closeButtonText);\n            $('#chooseBonusProductModal .modal-body').html(parsedHtml.body);\n            $('#chooseBonusProductModal .modal-footer').html(parsedHtml.footer);\n            $('#chooseBonusProductModal').modal('show');\n            $.spinner().stop();\n        },\n        error: function () {\n            $.spinner().stop();\n        }\n    });\n}\n\n/**\n * Updates the Mini-Cart quantity value after the customer has pressed the \"Add to Cart\" button\n * @param {string} response - ajax response from clicking the add to cart button\n */\nfunction handlePostCartAdd(response) {\n    $('.minicart').trigger('count:update', response);\n    var messageType = response.error ? 'alert-danger' : 'alert-success';\n    // show add to cart toast\n    if (response.newBonusDiscountLineItem\n        && Object.keys(response.newBonusDiscountLineItem).length !== 0) {\n        chooseBonusProducts(response.newBonusDiscountLineItem);\n    } else {\n        if ($('.add-to-cart-messages').length === 0) {\n            $('body').append(\n                '<div class=\"add-to-cart-messages\"></div>'\n            );\n        }\n\n        $('.add-to-cart-messages').append(\n            '<div class=\"alert ' + messageType + ' add-to-basket-alert text-center\" role=\"alert\">'\n            + response.message\n            + '</div>'\n        );\n\n        setTimeout(function () {\n            $('.add-to-basket-alert').remove();\n        }, 5000);\n    }\n}\n\n/**\n * Retrieves the bundle product item ID's for the Controller to replace bundle master product\n * items with their selected variants\n *\n * @return {string[]} - List of selected bundle product item ID's\n */\nfunction getChildProducts() {\n    var childProducts = [];\n    $('.bundle-item').each(function () {\n        childProducts.push({\n            pid: $(this).find('.product-id').text(),\n            quantity: parseInt($(this).find('label.quantity').data('quantity'), 10)\n        });\n    });\n\n    return childProducts.length ? JSON.stringify(childProducts) : [];\n}\n\n/**\n * Retrieve product options\n *\n * @param {jQuery} $productContainer - DOM element for current product\n * @return {string} - Product options and their selected values\n */\nfunction getOptions($productContainer) {\n    var options = $productContainer\n        .find('.product-option')\n        .map(function () {\n            var $elOption = $(this).find('.options-select');\n            var urlValue = $elOption.val();\n            var selectedValueId = $elOption.find('option[value=\"' + urlValue + '\"]')\n                .data('value-id');\n            return {\n                optionId: $(this).data('option-id'),\n                selectedValueId: selectedValueId\n            };\n        }).toArray();\n\n    return JSON.stringify(options);\n}\n\n/**\n * Makes a call to the server to report the event of adding an item to the cart\n *\n * @param {string | boolean} url - a string representing the end point to hit so that the event can be recorded, or false\n */\nfunction miniCartReportingUrl(url) {\n    if (url) {\n        $.ajax({\n            url: url,\n            method: 'GET',\n            success: function () {\n                // reporting urls hit on the server\n            },\n            error: function () {\n                // no reporting urls hit on the server\n            }\n        });\n    }\n}\n\nmodule.exports = {\n    attributeSelect: attributeSelect,\n    methods: {\n        editBonusProducts: function (data) {\n            chooseBonusProducts(data);\n        }\n    },\n\n    focusChooseBonusProductModal: function () {\n        $('body').on('shown.bs.modal', '#chooseBonusProductModal', function () {\n            $('#chooseBonusProductModal').siblings().attr('aria-hidden', 'true');\n            $('#chooseBonusProductModal .close').focus();\n        });\n    },\n\n    onClosingChooseBonusProductModal: function () {\n        $('body').on('hidden.bs.modal', '#chooseBonusProductModal', function () {\n            $('#chooseBonusProductModal').siblings().attr('aria-hidden', 'false');\n        });\n    },\n\n    trapChooseBonusProductModalFocus: function () {\n        $('body').on('keydown', '#chooseBonusProductModal', function (e) {\n            var focusParams = {\n                event: e,\n                containerSelector: '#chooseBonusProductModal',\n                firstElementSelector: '.close',\n                lastElementSelector: '.add-bonus-products'\n            };\n            focusHelper.setTabNextFocus(focusParams);\n        });\n    },\n\n    colorAttribute: function () {\n        $(document).on('click', '[data-attr=\"color\"] button', function (e) {\n            e.preventDefault();\n\n            if ($(this).attr('disabled')) {\n                return;\n            }\n            var $productContainer = $(this).closest('.set-item');\n            if (!$productContainer.length) {\n                $productContainer = $(this).closest('.product-detail');\n            }\n\n            attributeSelect($(this).attr('data-url'), $productContainer);\n        });\n    },\n\n    selectAttribute: function () {\n        $(document).on('change', 'select[class*=\"select-\"], .options-select', function (e) {\n            e.preventDefault();\n\n            var $productContainer = $(this).closest('.set-item');\n            if (!$productContainer.length) {\n                $productContainer = $(this).closest('.product-detail');\n            }\n            attributeSelect(e.currentTarget.value, $productContainer);\n        });\n    },\n\n    availability: function () {\n        $(document).on('change', '.quantity-select', function (e) {\n            e.preventDefault();\n\n            var $productContainer = $(this).closest('.product-detail');\n            if (!$productContainer.length) {\n                $productContainer = $(this).closest('.modal-content').find('.product-quickview');\n            }\n\n            if ($('.bundle-items', $productContainer).length === 0) {\n                attributeSelect($(e.currentTarget).find('option:selected').data('url'),\n                    $productContainer);\n            }\n        });\n    },\n\n    addToCart: function () {\n        $(document).on('click', 'button.add-to-cart, button.add-to-cart-global', function () {\n            var addToCartUrl;\n            var pid;\n            var pidsObj;\n            var setPids;\n\n            $('body').trigger('product:beforeAddToCart', this);\n\n            if ($('.set-items').length && $(this).hasClass('add-to-cart-global')) {\n                setPids = [];\n\n                $('.product-detail').each(function () {\n                    if (!$(this).hasClass('product-set-detail')) {\n                        setPids.push({\n                            pid: $(this).find('.product-id').text(),\n                            qty: $(this).find('.quantity-select').val(),\n                            options: getOptions($(this))\n                        });\n                    }\n                });\n                pidsObj = JSON.stringify(setPids);\n            }\n\n            pid = getPidValue($(this));\n\n            var $productContainer = $(this).closest('.product-detail');\n            if (!$productContainer.length) {\n                $productContainer = $(this).closest('.quick-view-dialog').find('.product-detail');\n            }\n\n            addToCartUrl = getAddToCartUrl();\n\n            var form = {\n                pid: pid,\n                pidsObj: pidsObj,\n                childProducts: getChildProducts(),\n                quantity: getQuantitySelected($(this))\n            };\n\n            if (!$('.bundle-item').length) {\n                form.options = getOptions($productContainer);\n            }\n\n            $(this).trigger('updateAddToCartFormData', form);\n            if (addToCartUrl) {\n                $.ajax({\n                    url: addToCartUrl,\n                    method: 'POST',\n                    data: form,\n                    success: function (data) {\n                        handlePostCartAdd(data);\n                        $('body').trigger('product:afterAddToCart', data);\n                        $.spinner().stop();\n                        miniCartReportingUrl(data.reportingURL);\n                    },\n                    error: function () {\n                        $.spinner().stop();\n                    }\n                });\n            }\n        });\n    },\n    selectBonusProduct: function () {\n        $(document).on('click', '.select-bonus-product', function () {\n            var $choiceOfBonusProduct = $(this).parents('.choice-of-bonus-product');\n            var pid = $(this).data('pid');\n            var maxPids = $('.choose-bonus-product-dialog').data('total-qty');\n            var submittedQty = parseInt($choiceOfBonusProduct.find('.bonus-quantity-select').val(), 10);\n            var totalQty = 0;\n            $.each($('#chooseBonusProductModal .selected-bonus-products .selected-pid'), function () {\n                totalQty += $(this).data('qty');\n            });\n            totalQty += submittedQty;\n            var optionID = $choiceOfBonusProduct.find('.product-option').data('option-id');\n            var valueId = $choiceOfBonusProduct.find('.options-select option:selected').data('valueId');\n            if (totalQty <= maxPids) {\n                var selectedBonusProductHtml = ''\n                + '<div class=\"selected-pid row\" '\n                + 'data-pid=\"' + pid + '\"'\n                + 'data-qty=\"' + submittedQty + '\"'\n                + 'data-optionID=\"' + (optionID || '') + '\"'\n                + 'data-option-selected-value=\"' + (valueId || '') + '\"'\n                + '>'\n                + '<div class=\"col-sm-11 col-9 bonus-product-name\" >'\n                + $choiceOfBonusProduct.find('.product-name').html()\n                + '</div>'\n                + '<div class=\"col-1\"><i class=\"fa fa-times\" aria-hidden=\"true\"></i></div>'\n                + '</div>'\n                ;\n                $('#chooseBonusProductModal .selected-bonus-products').append(selectedBonusProductHtml);\n                $('.pre-cart-products').html(totalQty);\n                $('.selected-bonus-products .bonus-summary').removeClass('alert-danger');\n            } else {\n                $('.selected-bonus-products .bonus-summary').addClass('alert-danger');\n            }\n        });\n    },\n    removeBonusProduct: function () {\n        $(document).on('click', '.selected-pid', function () {\n            $(this).remove();\n            var $selected = $('#chooseBonusProductModal .selected-bonus-products .selected-pid');\n            var count = 0;\n            if ($selected.length) {\n                $selected.each(function () {\n                    count += parseInt($(this).data('qty'), 10);\n                });\n            }\n\n            $('.pre-cart-products').html(count);\n            $('.selected-bonus-products .bonus-summary').removeClass('alert-danger');\n        });\n    },\n    enableBonusProductSelection: function () {\n        $('body').on('bonusproduct:updateSelectButton', function (e, response) {\n            $('button.select-bonus-product', response.$productContainer).attr('disabled',\n                (!response.product.readyToOrder || !response.product.available));\n            var pid = response.product.id;\n            $('button.select-bonus-product', response.$productContainer).data('pid', pid);\n        });\n    },\n    showMoreBonusProducts: function () {\n        $(document).on('click', '.show-more-bonus-products', function () {\n            var url = $(this).data('url');\n            $('.modal-content').spinner().start();\n            $.ajax({\n                url: url,\n                method: 'GET',\n                success: function (html) {\n                    var parsedHtml = parseHtml(html);\n                    $('.modal-body').append(parsedHtml.body);\n                    $('.show-more-bonus-products:first').remove();\n                    $('.modal-content').spinner().stop();\n                },\n                error: function () {\n                    $('.modal-content').spinner().stop();\n                }\n            });\n        });\n    },\n    addBonusProductsToCart: function () {\n        $(document).on('click', '.add-bonus-products', function () {\n            var $readyToOrderBonusProducts = $('.choose-bonus-product-dialog .selected-pid');\n            var queryString = '?pids=';\n            var url = $('.choose-bonus-product-dialog').data('addtocarturl');\n            var pidsObject = {\n                bonusProducts: []\n            };\n\n            $.each($readyToOrderBonusProducts, function () {\n                var qtyOption =\n                    parseInt($(this)\n                        .data('qty'), 10);\n\n                var option = null;\n                if (qtyOption > 0) {\n                    if ($(this).data('optionid') && $(this).data('option-selected-value')) {\n                        option = {};\n                        option.optionId = $(this).data('optionid');\n                        option.productId = $(this).data('pid');\n                        option.selectedValueId = $(this).data('option-selected-value');\n                    }\n                    pidsObject.bonusProducts.push({\n                        pid: $(this).data('pid'),\n                        qty: qtyOption,\n                        options: [option]\n                    });\n                    pidsObject.totalQty = parseInt($('.pre-cart-products').html(), 10);\n                }\n            });\n            queryString += JSON.stringify(pidsObject);\n            queryString = queryString + '&uuid=' + $('.choose-bonus-product-dialog').data('uuid');\n            queryString = queryString + '&pliuuid=' + $('.choose-bonus-product-dialog').data('pliuuid');\n            $.spinner().start();\n            $.ajax({\n                url: url + queryString,\n                method: 'POST',\n                success: function (data) {\n                    $.spinner().stop();\n                    if (data.error) {\n                        $('#chooseBonusProductModal').modal('hide');\n                        if ($('.add-to-cart-messages').length === 0) {\n                            $('body').append('<div class=\"add-to-cart-messages\"></div>');\n                        }\n                        $('.add-to-cart-messages').append(\n                            '<div class=\"alert alert-danger add-to-basket-alert text-center\"'\n                            + ' role=\"alert\">'\n                            + data.errorMessage + '</div>'\n                        );\n                        setTimeout(function () {\n                            $('.add-to-basket-alert').remove();\n                        }, 3000);\n                    } else {\n                        $('.configure-bonus-product-attributes').html(data);\n                        $('.bonus-products-step2').removeClass('hidden-xl-down');\n                        $('#chooseBonusProductModal').modal('hide');\n\n                        if ($('.add-to-cart-messages').length === 0) {\n                            $('body').append('<div class=\"add-to-cart-messages\"></div>');\n                        }\n                        $('.minicart-quantity').html(data.totalQty);\n                        $('.add-to-cart-messages').append(\n                            '<div class=\"alert alert-success add-to-basket-alert text-center\"'\n                            + ' role=\"alert\">'\n                            + data.msgSuccess + '</div>'\n                        );\n                        setTimeout(function () {\n                            $('.add-to-basket-alert').remove();\n                            if ($('.cart-page').length) {\n                                location.reload();\n                            }\n                        }, 1500);\n                    }\n                },\n                error: function () {\n                    $.spinner().stop();\n                }\n            });\n        });\n    },\n\n    getPidValue: getPidValue,\n    getQuantitySelected: getQuantitySelected,\n    miniCartReportingUrl: miniCartReportingUrl\n};\n","'use strict';\n\nmodule.exports = function (include) {\n    if (typeof include === 'function') {\n        include();\n    } else if (typeof include === 'object') {\n        Object.keys(include).forEach(function (key) {\n            if (typeof include[key] === 'function') {\n                include[key]();\n            }\n        });\n    }\n};\n"],"sourceRoot":""}